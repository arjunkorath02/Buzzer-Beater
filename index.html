// --- PROJECTOR VIEW (Corrected Sorting) ---
const ProjectorView = ({ gameCode }) => {
  const [game, setGame] = useState(null);
  useEffect(() => onSnapshot(getGameDocRef(gameCode), (d) => setGame(d.data())), [gameCode]);

  if (!game) return <InlineLoading msg="Connecting Projector..." />;

  // Dynamic sorting by score (Descending)
  const players = Object.values(game.players || {}).sort((a, b) => b.score - a.score);
  const buzzes = (game.buzzes || []).slice(0, 5);

  return (
    <div className="min-h-screen text-white flex flex-col p-8">
       {/* ... Header UI ... */}
       <div className="flex-1 flex gap-8 min-h-0">
          {/* Buzzer List */}
          <div className="flex-1 glass-panel rounded-3xl p-8">
             <h2 className="text-2xl font-bold mb-6 text-pink-400 uppercase tracking-widest flex items-center gap-2"><Zap /> Buzzers</h2>
             <div className="space-y-4">
                {buzzes.map((b, i) => (
                  <div key={i} className="glass-btn p-6 rounded-2xl flex justify-between items-center">
                    <div className="flex items-center gap-6">
                        <div className="bg-white text-black w-12 h-12 rounded-full flex items-center justify-center font-black text-2xl">{i+1}</div>
                        <div className="text-4xl font-bold">{b.playerName}</div>
                    </div>
                    <div className="text-2xl font-mono text-slate-400">
                        {i===0 ? "WINNER" : `+${b.timestamp - buzzes[0].timestamp}ms`}
                    </div>
                  </div>
                ))}
             </div>
          </div>

          {/* Correctly Sorted Standings */}
          <div className="w-1/3 glass-panel rounded-3xl p-8 overflow-hidden flex flex-col">
             <h2 className="text-2xl font-bold mb-6 text-yellow-400 uppercase tracking-widest flex items-center gap-2"><Trophy /> Standings</h2>
             <div className="overflow-y-auto pr-2 space-y-4">
                {players.map((p, i) => (
                  <div key={p.id} className="flex justify-between items-center py-2 border-b border-white/5">
                    <span className="text-xl font-bold">
                        {/* Rank is now based on sorted position */}
                        <span className="text-slate-500 text-sm font-mono mr-3">#{i+1}</span>
                        {p.name}
                    </span>
                    <span className="text-2xl font-mono font-bold text-yellow-500">{p.score}</span>
                  </div>
                ))}
             </div>
          </div>
       </div>
    </div>
  );
};

// --- HOST VIEW (Corrected Table Sorting) ---
// Inside the return statement of HostView, replace the table body with this:
<tbody>
  {Object.values(gameData.players || {})
    .sort((a, b) => b.score - a.score) // <-- Added this sorting line
    .map((p, index) => (
      <tr key={p.id} className="border-b border-white/5">
        <td className="p-4">
            <span className="text-slate-500 text-xs font-mono mr-2">#{index + 1}</span>
            <span className="font-bold">{p.name}</span>
        </td>
        <td className="p-4"><span className="bg-yellow-500/10 text-yellow-500 px-3 py-1 rounded font-mono">{p.code}</span></td>
        <td className="p-4 text-right font-mono text-xl">{p.score}</td>
        <td className="p-4 flex justify-end gap-2">
           <button onClick={() => updateDoc(getGameDocRef(activeGameId), { [`players.${p.id}.score`]: p.score + 1 })} className="p-2 glass-btn rounded text-green-400"><Plus size={14}/></button>
           <button onClick={() => updateDoc(getGameDocRef(activeGameId), { [`players.${p.id}.score`]: p.score - 1 })} className="p-2 glass-btn rounded text-red-400"><Minus size={14}/></button>
           <button onClick={() => updateDoc(getGameDocRef(activeGameId), { [`players.${p.id}`]: deleteField() })} className="p-2 text-slate-500 hover:text-red-500"><Trash2 size={14}/></button>
        </td>
      </tr>
  ))}
</tbody>
